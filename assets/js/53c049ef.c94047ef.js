"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5674],{98048:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var i=t(85893),a=t(11151);const s={sidebar_position:4},r="AprilTag\u59ff\u6001\u4f30\u8ba1",o={id:"CanaanK230/part13/findApriltags3dPose",title:"AprilTag\u59ff\u6001\u4f30\u8ba1",description:"1.\u5b9e\u9a8c\u76ee\u7684",source:"@site/docs/CanaanK230/part13/04-findApriltags3dPose.md",sourceDirName:"CanaanK230/part13",slug:"/CanaanK230/part13/findApriltags3dPose",permalink:"/CanaanK230/part13/findApriltags3dPose",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/eLinuxAI-TrainingDocs/tree/main/docs/CanaanK230/part13/04-findApriltags3dPose.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"canaanK230Sidebar",previous:{title:"AprilTag\u6807\u7b7e\u8bc6\u522b",permalink:"/CanaanK230/part13/findApriltags"},next:{title:"AI\u89c6\u89c9\u5b9e\u9a8c",permalink:"/category/ai\u89c6\u89c9\u5b9e\u9a8c"}},p={},d=[{value:"1.\u5b9e\u9a8c\u76ee\u7684",id:"1\u5b9e\u9a8c\u76ee\u7684",level:2},{value:"2.\u793a\u4f8b\u4ee3\u7801",id:"2\u793a\u4f8b\u4ee3\u7801",level:2},{value:"3.\u5b9e\u9a8c\u7ed3\u679c",id:"3\u5b9e\u9a8c\u7ed3\u679c",level:2}];function l(n){const e={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"apriltag\u59ff\u6001\u4f30\u8ba1",children:"AprilTag\u59ff\u6001\u4f30\u8ba1"}),"\n",(0,i.jsx)(e.h2,{id:"1\u5b9e\u9a8c\u76ee\u7684",children:"1.\u5b9e\u9a8c\u76ee\u7684"}),"\n",(0,i.jsx)(e.p,{children:"\u8bc6\u522bAprilTag\u5e76\u8f93\u51fa\u59ff\u6001\u4fe1\u606f\uff08Tx\u3001Ty\u3001Tz\u3001Rx\u3001Ry\u3001Rz\uff09\uff0c\u5373\u4f4d\u79fb\u548c\u65cb\u8f6c\u89d2\u5ea6\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"2\u793a\u4f8b\u4ee3\u7801",children:"2.\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"'''\n\u672c\u7a0b\u5e8f\u9075\u5faaGPL V3\u534f\u8bae, \u8bf7\u9075\u5faa\u534f\u8bae\n\u5b9e\u9a8c\u5e73\u53f0: DshanPI CanMV\n\u5f00\u53d1\u677f\u6587\u6863\u7ad9\u70b9\t: https://eai.100ask.net/\n\u767e\u95ee\u7f51\u5b66\u4e60\u5e73\u53f0   : https://www.100ask.net\n\u767e\u95ee\u7f51\u5b98\u65b9B\u7ad9    : https://space.bilibili.com/275908810\n\u767e\u95ee\u7f51\u5b98\u65b9\u6dd8\u5b9d   : https://100ask.taobao.com\n'''\n\nimport time, math, os, gc, sys\n\nfrom media.sensor import *\nfrom media.display import *\nfrom media.media import *\n\n# \u6ce8\u610f\uff01\u4e0e find_qrcodes \u4e0d\u540c\uff0cfind_apriltags \u65b9\u6cd5\u5728\u68c0\u6d4b\u65f6\u4e0d\u9700\u8981\u5bf9\u56fe\u50cf\u8fdb\u884c\u7578\u53d8\u6821\u6b63\u3002\n\n# \u4e0d\u540c\u7684 Tag \u5bb6\u65cf\u6709\u4f55\u533a\u522b\uff1f\u4f8b\u5982\uff0cTAG16H5 \u662f\u4e00\u4e2a 4x4 \u7684\u6b63\u65b9\u5f62\u6807\u7b7e\uff0c\n# \u6240\u4ee5\u5b83\u5728\u66f4\u8fdc\u7684\u8ddd\u79bb\u4e0a\u4e5f\u53ef\u4ee5\u88ab\u68c0\u6d4b\u5230\u3002\u800c TAG36H11 \u662f\u4e00\u4e2a 6x6 \u7684\u6807\u7b7e\uff0c\n# \u66f4\u96be\u8bc6\u522b\u4f46\u66f4\u53ef\u9760\u3002\u8f83\u4f4e\u7684 H \u503c\uff08\u5982 H5 \u76f8\u8f83\u4e8e H11\uff09\u610f\u5473\u7740\u8bef\u8bc6\u522b\u7387\u66f4\u9ad8\u3002\n# \u56e0\u6b64\uff0c\u9664\u975e\u4f60\u6709\u7279\u522b\u9700\u6c42\uff0c\u5426\u5219\u9ed8\u8ba4\u4f7f\u7528 TAG36H11 \u5373\u53ef\u3002\n\n# AprilTags \u5e93\u5728\u68c0\u6d4b\u5230\u6807\u7b7e\u540e\u53ef\u4ee5\u8f93\u51fa\u59ff\u6001\u4fe1\u606f\uff0c\u5305\u62ec x/y/z \u7684\u5e73\u79fb\u4e0e\u65cb\u8f6c\u3002\n# \u5e73\u79fb\u5355\u4f4d\u662f\u65e0\u91cf\u7eb2\u7684\uff08\u9700\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u6362\u7b97\uff09\uff0c\u65cb\u8f6c\u5355\u4f4d\u662f\u5f27\u5ea6\uff0c\u53ef\u8f6c\u4e3a\u89d2\u5ea6\u3002\n# \u672c\u7a0b\u5e8f\u4f1a\u5c06\u5176\u8f6c\u6362\u4e3a\u89d2\u5ea6\u8fdb\u884c\u8f93\u51fa\u3002\n\n# f_x \u8868\u793a\u76f8\u673a\u7684\u6c34\u5e73\u7126\u8ddd\uff0c\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a\u955c\u5934\u7126\u8ddd \xf7 \u4f20\u611f\u5668\u6c34\u5e73\u5c3a\u5bf8 \xd7 \u56fe\u50cf\u5bbd\u5ea6\uff08\u50cf\u7d20\uff09\n# f_y \u8868\u793a\u76f8\u673a\u7684\u5782\u76f4\u7126\u8ddd\uff0c\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a\u955c\u5934\u7126\u8ddd \xf7 \u4f20\u611f\u5668\u5782\u76f4\u5c3a\u5bf8 \xd7 \u56fe\u50cf\u9ad8\u5ea6\uff08\u50cf\u7d20\uff09\n# \u4ee5\u4e0b\u53c2\u6570\u9002\u7528\u4e8e OV7725 \u76f8\u673a\u642d\u914d 2.8mm \u955c\u5934\u3002\n\n# c_x \u548c c_y \u662f\u56fe\u50cf\u4e2d\u5fc3\u70b9\u7684\u50cf\u7d20\u5750\u6807\uff0c\u901a\u5e38\u8bbe\u4e3a\u56fe\u50cf\u5bbd\u9ad8\u7684\u4e00\u534a\u3002\n\nDETECT_WIDTH = 320    # \u56fe\u50cf\u5bbd\u5ea6\nDETECT_HEIGHT = 240   # \u56fe\u50cf\u9ad8\u5ea6\n\nf_x = (2.8 / 3.984) * DETECT_WIDTH    # \u6c34\u5e73\u65b9\u5411\u7126\u8ddd\nf_y = (2.8 / 2.952) * DETECT_HEIGHT   # \u5782\u76f4\u65b9\u5411\u7126\u8ddd\nc_x = DETECT_WIDTH * 0.5              # \u56fe\u50cf\u4e2d\u5fc3 X \u5750\u6807\nc_y = DETECT_HEIGHT * 0.5             # \u56fe\u50cf\u4e2d\u5fc3 Y \u5750\u6807\n\ndef degrees(radians):\n    return (180 * radians) / math.pi  # \u5f27\u5ea6\u8f6c\u89d2\u5ea6\n\nsensor = None\n\ntry:\n    # \u6784\u9020 Sensor \u5bf9\u8c61\n    sensor = Sensor(width = DETECT_WIDTH, height = DETECT_HEIGHT)\n    sensor.reset()  # \u590d\u4f4d\u6444\u50cf\u5934\n\n    # \u53ef\u9009\uff1a\u955c\u50cf\u548c\u7ffb\u8f6c\u8bbe\u7f6e\n    # sensor.set_hmirror(False)  # \u8bbe\u7f6e\u6c34\u5e73\u955c\u50cf\n    # sensor.set_vflip(False)    # \u8bbe\u7f6e\u5782\u76f4\u7ffb\u8f6c\n\n    sensor.set_framesize(width = DETECT_WIDTH, height = DETECT_HEIGHT)  # \u8bbe\u7f6e\u8f93\u51fa\u56fe\u50cf\u5c3a\u5bf8\n    sensor.set_pixformat(Sensor.RGB565)  # \u8bbe\u7f6e\u56fe\u50cf\u683c\u5f0f\u4e3a RGB565\n\n    # \u521d\u59cb\u5316 LCD \u663e\u793a\u5668\uff08\u9ed8\u8ba4\u4f7f\u7528 ST7701\uff09\n    Display.init(Display.ST7701, to_ide = True)\n\n    # \u5982\u679c\u4f7f\u7528 HDMI\uff0c\u8bf7\u53d6\u6d88\u6ce8\u91ca\u4ee5\u4e0b\u4efb\u4e00\u914d\u7f6e\uff08\u5e76\u6ce8\u91ca LCD \u90e8\u5206\uff09\n    # HDMI \u8f93\u51fa\uff08VGA \u6a21\u5f0f\uff09\n    # Display.init(Display.LT9611, width = 640, height = 480, to_ide = True)\n\n    # HDMI \u8f93\u51fa\uff081080P \u6a21\u5f0f\uff09\n    # Display.init(Display.LT9611, width = 1920, height = 1080, to_ide = True)\n\n    # \u521d\u59cb\u5316\u5a92\u4f53\u7ba1\u7406\u5668\n    MediaManager.init()\n\n    # \u542f\u52a8\u6444\u50cf\u5934\u91c7\u96c6\n    sensor.run()\n\n    fps = time.clock()  # \u521d\u59cb\u5316\u5e27\u7387\u8ba1\u6570\u5668\n\n    while True:\n        fps.tick()  # \u542f\u52a8\u5e27\u7387\u8ba1\u65f6\n\n        os.exitpoint()  # \u68c0\u67e5\u9000\u51fa\u70b9\uff08CanMV \u7279\u6709\uff0c\u7528\u4e8e\u8c03\u8bd5\u6216\u811a\u672c\u7ba1\u7406\uff09\n        img = sensor.snapshot()  # \u62cd\u6444\u5f53\u524d\u56fe\u50cf\n\n        # \u68c0\u6d4b AprilTag\uff0c\u9ed8\u8ba4\u4f7f\u7528 TAG36H11 \u5bb6\u65cf\n        for tag in img.find_apriltags(fx=f_x, fy=f_y, cx=c_x, cy=c_y):\n            # \u7ed8\u5236\u68c0\u6d4b\u6846\n            img.draw_rectangle([v for v in tag.rect()], color=(255, 0, 0))\n            # \u5728\u4e2d\u5fc3\u4f4d\u7f6e\u7ed8\u5236\u5341\u5b57\n            img.draw_cross(tag.cx(), tag.cy(), color=(0, 255, 0))\n\n            print_args = (\n                tag.x_translation(), tag.y_translation(), tag.z_translation(),\n                degrees(tag.x_rotation()), degrees(tag.y_rotation()), degrees(tag.z_rotation())\n            )\n\n            # \u8f93\u51fa\u6807\u7b7e\u59ff\u6001\u4fe1\u606f\n            print(\"Tx: %f, Ty %f, Tz %f, Rx %f, Ry %f, Rz %f\" % print_args)\n\n        # \u56fe\u50cf\u663e\u793a\u5230\u5c4f\u5e55\u4e2d\u592e\n        Display.show_image(\n            img,\n            x=round((800 - sensor.width()) / 2),\n            y=round((480 - sensor.height()) / 2)\n        )\n\n        gc.collect()  # \u6267\u884c\u5783\u573e\u56de\u6536\uff08\u91ca\u653e\u5185\u5b58\uff09\n        print(fps.fps())  # \u8f93\u51fa\u5f53\u524d\u5e27\u7387\n\nexcept KeyboardInterrupt as e:\n    print(f\"\u7528\u6237\u4e3b\u52a8\u4e2d\u65ad\u7a0b\u5e8f\")\nexcept BaseException as e:\n    print(f\"\u53d1\u751f\u5f02\u5e38: '{e}'\")\nfinally:\n    # \u505c\u6b62\u6444\u50cf\u5934\n    if isinstance(sensor, Sensor):\n        sensor.stop()\n\n    # \u91ca\u653e\u663e\u793a\u5668\n    Display.deinit()\n\n    # \u8bbe\u7f6e\u9000\u51fa\u70b9\u5e76\u4f11\u7720\u4e00\u6bb5\u65f6\u95f4\uff08\u7528\u4e8e\u7cfb\u7edf\u5207\u6362\uff09\n    os.exitpoint(os.EXITPOINT_ENABLE_SLEEP)\n    time.sleep_ms(100)\n\n    # \u91ca\u653e\u5a92\u4f53\u8d44\u6e90\n    MediaManager.deinit()\n\n"})}),"\n",(0,i.jsx)(e.h2,{id:"3\u5b9e\u9a8c\u7ed3\u679c",children:"3.\u5b9e\u9a8c\u7ed3\u679c"}),"\n",(0,i.jsx)(e.p,{children:"\u70b9\u51fb\u8fd0\u884c\u4ee3\u7801\u540e\uff0c\u4f1a\u5728\u663e\u793a\u5c4f\u4e0a\u8bc6\u522bAprilTag\u6807\u7b7e\u5e76\u6253\u5370\u6807\u7b7e\u7684\u59ff\u6001\u4fe1\u606f\u3002"})]})}function c(n={}){const{wrapper:e}={...(0,a.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},11151:(n,e,t)=>{t.d(e,{Z:()=>o,a:()=>r});var i=t(67294);const a={},s=i.createContext(a);function r(n){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:r(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);