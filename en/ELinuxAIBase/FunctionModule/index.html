<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ELinuxAIBase/FunctionModule" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">11.功能模块 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://eai.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://eai.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://eai.100ask.net/en/ELinuxAIBase/FunctionModule"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="11.功能模块 | 东山Π"><meta data-rh="true" name="description" content="3.1 推理结果分析"><meta data-rh="true" property="og:description" content="3.1 推理结果分析"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://eai.100ask.net/en/ELinuxAIBase/FunctionModule"><link data-rh="true" rel="alternate" href="https://eai.100ask.net/ELinuxAIBase/FunctionModule" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://eai.100ask.net/en/ELinuxAIBase/FunctionModule" hreflang="en"><link data-rh="true" rel="alternate" href="https://eai.100ask.net/ELinuxAIBase/FunctionModule" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.e3ab61ce.css">
<script src="/en/assets/js/runtime~main.46878e81.js" defer="defer"></script>
<script src="/en/assets/js/main.c4e761f6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="DshanPI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="DshanPI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">eLinux AI开发</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/ELinuxAIBase/BoardIntroduction-1">嵌入式AI基础</a><a class="navbar__item navbar__link" href="/en/CanaanK230/Userdoc">嘉楠K230开发</a><a class="navbar__item navbar__link" href="/en/CanaanK510/YOLOV5-ObjectDetectionAlgorithm">嘉楠K510开发</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/ELinuxAIBase/FunctionModule" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/ELinuxAIBase/FunctionModule" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/eLinuxAI-TrainingDocs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/BoardIntroduction-1">1. 嵌入式AI学习路线</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/BoardIntroduction">2. 资料下载</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/ArtificialIntelligenceAndMachineLearning">3. 人工智能与机器学习</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/DeepLearningAndNeuralNetworks">4.深度学习及神经网络</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/BasicOperatorsAndConvolutionalNeuralNetworks">5.基础算子及卷积神经网络</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/IntroductionToDeepLearningFrameworkPytorch">6.深度学习框架Pytorch入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/ModelAndDeployment">7.模型及部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/EdgeDeployment">8.边缘部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/DataLayer-DataAcquisition">9.数据层-数据采集</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/ELinuxAIBase/ModelLayerAndComputingPowerLayer">10.模型层和算力层</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/en/ELinuxAIBase/FunctionModule">11.功能模块</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">11.功能模块</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>11.功能模块</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-推理结果分析">3.1 推理结果分析<a href="#31-推理结果分析" class="hash-link" aria-label="Direct link to 3.1 推理结果分析" title="Direct link to 3.1 推理结果分析">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-解码预测结果">3.1.1 解码预测结果<a href="#311-解码预测结果" class="hash-link" aria-label="Direct link to 3.1.1 解码预测结果" title="Direct link to 3.1.1 解码预测结果">​</a></h4>
<p>模型解码预测结果是指将神经网络模型输出的预测结果进行解析和转换，以得到最终的预测结果。</p>
<p>具体来说，模型解码预测结果包括以下步骤：</p>
<ol>
<li><strong>获取预测结果</strong>：神经网络模型在推理过程中会输出预测结果，这些结果通常以概率或得分的形式表示。</li>
<li><strong>解码分类预测</strong>：对于分类任务，神经网络模型会输出每个类别的概率。我们需要将这些概率解码为具体的类别标签。通常，解码的方法是将概率最高的类别作为预测结果。</li>
<li><strong>解码位置信息</strong>：对于回归任务，神经网络模型会输出预测的位置信息，如边界框的坐标、尺寸等。我们需要将这些位置信息解码为具体的数值。</li>
</ol>
<p>下面我们以基于锚框的yolo算法为例，我们来看其模型的输入和输出内容。</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/image-20240117163536142.png" alt="image=" class="img_ev3q"></p>
<p>​	模型的输入节点，接收的tensor为[1,3,640,640]表示[batchsize，channel，height，weight]，即批次大小为1，也就是一次读1张图像；channel为3表示通道数，3通道彩色图像；高度和宽度则是单张图像的大小320*320像素。</p>
<p>​	模型的输出节点，输出的tensor为[1,25200,85]，其中1表示批次大小为1，每次输出一张图像的数据；25200表示有25k的锚框数量；85表示数据集有80个类/4个框坐标/1个类别置信度。我们来看这个85中的数据集有80个类/4个框坐标/1个类别置信度。由于yolov5使用的coco数据集，其中的图片的类别数是80个类。4个框坐标表示：中心坐标x，中心坐标y,宽度w，高度y。1个类别置信度表示：所有锚框对应的类别的检测概率值。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-非极大值抑制">3.1.2 非极大值抑制<a href="#312-非极大值抑制" class="hash-link" aria-label="Direct link to 3.1.2 非极大值抑制" title="Direct link to 3.1.2 非极大值抑制">​</a></h4>
<p><strong>非极大值抑制</strong>（NMS）是一种在目标检测中常用的后处理技术。它的主要目的是去除冗余的检测框，保留最优的检测结果。</p>
<p>在目标检测中，通常会使用滑动窗口或类似的方法来生成候选框，然后对这些候选框进行分类和定位精度的评估。但是，由于这种方法会产生大量的候选框，其中很多可能是重叠的，因此需要进行后处理来去除冗余和低质量的候选框，以得到最终的目标检测结果。</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/graphic4-1705370295354-3.jpg" alt="image=" class="img_ev3q"></p>
<p>NMS的基本思想是保留分类得分最高的候选框，并将其与周围候选框进行比较，去除与它重叠面积超过阈值的候选框。这个过程不断重复，直到所有候选框都被处理完。NMS可以有效地去除冗余和低质量的候选框，提高目标检测的准确率和效率。它通常被应用于目标检测的最后一步，用于生成最终的目标检测结果。</p>
<p>在NMS中，需要设定一个阈值来决定哪些候选框需要被去除。这个阈值的选择需要根据具体的应用场景和数据集来确定。如果阈值设置得过高，可能会导致漏检；如果阈值设置得过低，可能会导致误检。因此，选择合适的阈值是NMS的关键。</p>
<p>​	非极大值抑制NMS是一种在目标检测中常用的后处理技术，可以有效地去除冗余和低质量的候选框，提高目标检测的准确率和效率。常见的NMS算法有：最基本的贪心式NMS算法，改进的NMS算法，有Soft-NMS1，Matrix NMS2，Adaptive NMS3，DIoU-NMS4，IoU-guided NMS5等。</p>
<p>​	在开始学习NMS之前我们需要了解并集交叉点(Intersection Over Union) 或简称 <strong>IOU</strong>。通常用于量化真实值 BBox（边界框）和预测 BBox 之间重叠百分比的方法。由于目前很多目标检测算法都是基于锚框来进行预测的，也就是将图像分成多个网格，可以是密集的网格或者在感兴趣区域内的规则网格。每个网格的中心点是放置锚框的位置。锚框就是我们预先定义好的框，我们就可以将图像划分为一个个网格，基于每个网格放锚框，进行预测。</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/image-20240116115213146.png" alt="image=" class="img_ev3q"></p>
<p>现在我们就需要考虑IOU的问题就是考虑真实框和预测框重叠的百分比，其数学公式为:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>O</mi><mi>U</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>∩</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>∪</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">IOU= \frac{Target \cap Prediction}{Target \cup Prediction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>其中交集与并集的区域可如下图所示：</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/image-20240116141331061.png" alt="image=" class="img_ev3q"></p>
<p>真实框和预测框的交集区域是蓝色部分，并集区域是紫色部分，IOU的值可以通过将蓝色区域除以紫色区域得到。IOU就可以衡量真实框和预测框之间的相似性。它的值域再[0,1]，其中0表示没有重叠，1表示全部重叠。</p>
<p>​	下面我们使用C++来实现一个简单IOU的计算，我们计算两个Box的交并比，假设A框的左下角的坐标为(10,10)，右上角坐标为(100,100)。B框的左下角的坐标为(30,30)，右上角坐标为(150,150)。那么就可以计算出对应交集框的坐标值。A框和B框在坐标轴下的表示，如下图所示：</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/image-20240116164453695.png" alt="image=" class="img_ev3q">
下面展示C++程序源码：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;iostream&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;algorithm&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace std;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定义一个矩形框的结构体，包含左上角和右下角的坐标，以及置信度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Bbox {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int x1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int x2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float score;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 计算两个矩形框的IOU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float iou(const Bbox&amp; a, const Bbox&amp; b) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算两个矩形框的交集的左上角和右下角的坐标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inter_x1 = max(a.x1, b.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inter_y1 = max(a.y1, b.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inter_x2 = min(a.x2, b.x2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inter_y2 = min(a.y2, b.y2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 判断是否有交集，如果没有，返回0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (inter_x1 &gt;= inter_x2 || inter_y1 &gt;= inter_y2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算交集的面积</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inter_area = (inter_x2 - inter_x1) * (inter_y2 - inter_y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算两个矩形框的面积</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int area_a = (a.x2 - a.x1) * (a.y2 - a.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int area_b = (b.x2 - b.x1) * (b.y2 - b.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算并集的面积</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int union_area = area_a + area_b - inter_area;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算IOU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return inter_area * 1.0 / union_area;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//主函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 创建两个矩形框</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Bbox a = {10, 10, 100, 100, 0.9};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Bbox b = {30, 30, 150, 150, 0.8};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算IOU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float iou_value = iou(a, b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 输出结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cout &lt;&lt; &quot;IOU = &quot; &lt;&lt; iou_value &lt;&lt; endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>将矩阵A和矩阵B的参数传入iou函数中计算交并比，在iouh函数中分别计算交集的面积和并集的面积，最后计算IOU的值并返回。</p>
</blockquote>
<p>​	下面我们使用YOLOV5目标检测算法中的<a href="https://github.com/developer0hye/Modern-Cpp-NMS" target="_blank" rel="noopener noreferrer">开源NMS示例</a>来讲解NMS。前面我们学习了IOU交并比，nms就是在其基础上，按照预测的置信度分数对矩形框进行排序，然后依次选择最高置信度的矩形框，并删除与它重叠度超过一定阈值的其他矩形框。这样可以有效地减少重复或冗余的预测框，提高检测的效率和精度。我们需要定义提前好nms阈值，用于判断是否要删除一个矩形框的标准，一般在0.3到0.5之间。如果一个矩形框与已经选择的最高置信度的矩形框的iou大于阈值，那么它就被认为是多余的，需要被删除。</p>
<p>下面展示nms核心代码：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;nms.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;algorithm&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float iou(const std::vector&lt;float&gt;&amp; boxA, const std::vector&lt;float&gt;&amp; boxB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // The format of box is [top_left_x, top_left_y, bottom_right_x, bottom_right_y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const float eps = 1e-6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float iou = 0.f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float areaA = (boxA[2] - boxA[0]) * (boxA[3] - boxA[1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float areaB = (boxB[2] - boxB[0]) * (boxB[3] - boxB[1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float x1 = std::max(boxA[0], boxB[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float y1 = std::max(boxA[1], boxB[1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float x2 = std::min(boxA[2], boxB[2]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float y2 = std::min(boxA[3], boxB[3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float w = std::max(0.f, x2 - x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float h = std::max(0.f, y2 - y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float inter = w * h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iou = inter / (areaA + areaB - inter + eps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return iou;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void nms(std::vector&lt;std::vector&lt;float&gt;&gt;&amp; boxes, const float iou_threshold)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // The format of boxes is [[top_left_x, top_left_y, bottom_right_x, bottom_right_y, score, class_id], ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //“分数+class_id”排序是为了确保将具有相同class_id的框分组在一起，并按分数排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::sort(boxes.begin(), boxes.end(), [](const std::vector&lt;float&gt;&amp; boxA, const std::vector&lt;float&gt;&amp; boxB) { return boxA[4] + boxA[5] &gt; boxB[4] + boxB[5];});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; boxes.size(); ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (boxes[i][4] == 0.f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int j = i + 1; j &lt; boxes.size(); ++j)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (boxes[i][5] != boxes[j][5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (iou(boxes[i], boxes[j]) &gt; iou_threshold)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boxes[j][4] = 0.f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::erase_if(boxes, [](const std::vector&lt;float&gt;&amp; box) { return box[4] == 0.f; });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>运行全部代码需要额外安装fmt库，输入：sudo apt install libfmt-dev</p>
</blockquote>
<p>​	在Modern-Cpp-NMS目录下新建build目录存放编译文件，使用cmake编译程序，如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS$ mkdir build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS$ cd build/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS/build$ cmake ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The CXX compiler identification is GNU 9.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Detecting CXX compiler ABI info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Detecting CXX compiler ABI info - done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Check for working CXX compiler: /usr/bin/c++ - skipped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Detecting CXX compile features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Detecting CXX compile features - done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Configuring done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Generating done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Build files have been written to: /home/ubuntu/work/Modern-Cpp-NMS/build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS/build$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 33%] Building CXX object CMakeFiles/example.dir/example.cpp.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 66%] Building CXX object CMakeFiles/example.dir/nms.cpp.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[100%] Linking CXX executable example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[100%] Built target example</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行完成后我们可以在<code>build</code>目录下看到<code>example</code>可执行程序，执行可执 行程序会在当前目录下生成<code>boxes_nms.txt</code>文本文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS/build$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boxes.txt  CMakeCache.txt  CMakeFiles  cmake_install.cmake  example  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS/build$ ./example </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/Modern-Cpp-NMS/build$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boxes_nms.txt  CMakeCache.txt  cmake_install.cmake  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boxes.txt      CMakeFiles      example、</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以对比<code>boxes.txt</code>和<code>boxes_nms.txt</code>两个文件可以发现我们通过nms已经减少了预测框。将<code>boxes_nms.txt</code>文件拷贝到<code>Modern-Cpp-NMS</code>目录下，我们使用绘图程序查看<code>plot.py</code>经过nms前后的图像。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/work/Modern-Cpp-NMS/build$ cp boxes_nms.txt ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/work/Modern-Cpp-NMS/build$ cd ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/work/Modern-Cpp-NMS$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boxes_nms.txt  CMakeLists.txt  img_with_boxes.jpg      nms.cpp  README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boxes.txt      example.cpp     img_with_boxes_nms.jpg  nms.hpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build          img.jpg         LICENSE                 plot.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu@ubuntu2004:~/work/Modern-Cpp-NMS$ python plot.py </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行完成后会自动弹出两个窗口显示经过nms前后的图像，如下图所示：</p>
<p><img loading="lazy" src="http://photos.100ask.net/eLinuxAI-TrainingDocs/image-20240116194429752.png" alt="image-20240116194429752" class="img_ev3q"></p>
<p>经过NMS之后的图像，可以看到目标周围只有一个或少数几个边界框，而不是大量的重叠框。左图是NMS之前的图像，右图是NMS之后的图像，可以看到NMS有效地减少了冗余的边界框，提高了检测的效果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-drm显示">3.2 DRM显示<a href="#32-drm显示" class="hash-link" aria-label="Direct link to 3.2 DRM显示" title="Direct link to 3.2 DRM显示">​</a></h3>
<p>​	在视觉AI任务中，我们获得了目标检测框，一般我们还需要将检测框展示出来给用户看到检测结果，那么我们想在显示屏上进行显示，就需要了解DMR显示框架，怎么将检测框和摄像头获取到的图像叠加显示在显示屏上。</p>
<p>​	DRM（Direct Rendering Manager）是Linux主流的图形显示框架，它支持多图层合成，为用户图层提供统一的API（libdrm），来访问GPU，实现统一管理。在DRM显示框架中，KMS（Kernel Mode Setting）负责相关参数的设置（包括分辨率、刷新率、电源状态等）和显示画面的切换（显示buffer的切换，多图层的合成方式，以及每个图层的显示位置）。具体来说，DRM显示框架可以处理底层硬件和软件的交互，通过提供通用的API接口，使得软件架构更为统一，方便管理和维护。此外，DRM框架还可以支持多种显示硬件，包括液晶显示器、投影仪等。</p>
<p>DRM显示流程涉及到以下几个步骤：</p>
<ul>
<li>
<p>打开DRM设备文件：DRM框架成功加载后，会创建一个设备文件/dev/dri/cardX，上层用户应用可以通过该文件节点，获取显卡的各种操 作。</p>
</li>
<li>
<p>获取显卡资源句柄：通过drmModeGetResources函数，获取显卡的资源句柄，进而进行显卡资源的操作，如获取CRTC、Encoder、Connector等对象的信息。</p>
</li>
<li>
<p>分配和映射显示缓冲区：通过drmModeAddFB2函数，分配一个显示缓冲区（Framebuffer），并将其映射到用户空间，用于存储图像数据。</p>
</li>
<li>
<p>设置显示模式：通过drmModeSetCrtc函数，设置显示控制器（CRTC）的显示模式，如分辨率、刷新率、时序等，以及关联显示缓冲区和输出转换器（Encoder）。</p>
</li>
<li>
<p>设置输出连接器：通过drmModeSetConnector函数，设置输出连接器（Connector）的状态，如连接或断开，以及关联输出转换器（Encoder）。</p>
</li>
<li>
<p>绘制图像：通过drmModeMapDumb函数，将显示缓冲区映射到用户空间，然后通过memcpy或其他方式，将图像数据拷贝到显示缓冲区中。</p>
</li>
<li>
<p>切换显示缓冲区：通过drmModePageFlip函数，切换显示缓冲区，使得绘制的图像能够显示在屏幕上，同时注册一个回调函数，用于接收切换完成的通知。</p>
</li>
<li>
<p>等待垂直消影区：通过drmWaitVBlank函数，等待垂直消影区（VBLANK）的到来，这是显示器件软件和硬件的同步机制，通常基于硬件的VSYNC信号来实现。</p>
</li>
<li>
<p>释放显示缓冲区：通过drmModeRmFB函数，释放显示缓冲区，回收内存资源。</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/eLinuxAI-TrainingDocs/tree/main/docs/ELinuxAIBase/05-FunctionModule.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/ELinuxAIBase/ModelLayerAndComputingPowerLayer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">10.模型层和算力层</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#31-推理结果分析" class="table-of-contents__link toc-highlight">3.1 推理结果分析</a></li><li><a href="#32-drm显示" class="table-of-contents__link toc-highlight">3.2 DRM显示</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>