"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7912],{68525:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>f});var t=a(85893),i=a(11151);const s={sidebar_position:4},r="\u64ad\u653e\u97f3\u9891",l={id:"CanaanK230/part15/audioPlay",title:"\u64ad\u653e\u97f3\u9891",description:"1.\u5b9e\u9a8c\u76ee\u7684",source:"@site/docs/CanaanK230/part15/04-audioPlay.md",sourceDirName:"CanaanK230/part15",slug:"/CanaanK230/part15/audioPlay",permalink:"/en/CanaanK230/part15/audioPlay",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/eLinuxAI-TrainingDocs/tree/main/docs/CanaanK230/part15/04-audioPlay.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"canaanK230Sidebar",previous:{title:"\u5f55\u5236\u97f3\u9891",permalink:"/en/CanaanK230/part15/audioRec"},next:{title:"\u7f51\u7edc\u5e94\u7528",permalink:"/en/category/\u7f51\u7edc\u5e94\u7528"}},o={},f=[{value:"1.\u5b9e\u9a8c\u76ee\u7684",id:"1\u5b9e\u9a8c\u76ee\u7684",level:2},{value:"2.\u793a\u4f8b\u6e90\u7801",id:"2\u793a\u4f8b\u6e90\u7801",level:2},{value:"3.\u5b9e\u9a8c\u7ed3\u679c",id:"3\u5b9e\u9a8c\u7ed3\u679c",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"\u64ad\u653e\u97f3\u9891",children:"\u64ad\u653e\u97f3\u9891"}),"\n",(0,t.jsx)(n.h2,{id:"1\u5b9e\u9a8c\u76ee\u7684",children:"1.\u5b9e\u9a8c\u76ee\u7684"}),"\n",(0,t.jsx)(n.p,{children:"\u5b66\u4e60\u5b9e\u9a8c\u8033\u673a\u63a5\u53e3\u8fdb\u884c\u58f0\u97f3\u64ad\u653e\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"2\u793a\u4f8b\u6e90\u7801",children:"2.\u793a\u4f8b\u6e90\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\'\'\'\n\u672c\u7a0b\u5e8f\u9075\u5faaGPL V3\u534f\u8bae, \u8bf7\u9075\u5faa\u534f\u8bae\n\u5b9e\u9a8c\u5e73\u53f0: DshanPI CanMV\n\u5f00\u53d1\u677f\u6587\u6863\u7ad9\u70b9\t: https://eai.100ask.net/\n\u767e\u95ee\u7f51\u5b66\u4e60\u5e73\u53f0   : https://www.100ask.net\n\u767e\u95ee\u7f51\u5b98\u65b9B\u7ad9    : https://space.bilibili.com/275908810\n\u767e\u95ee\u7f51\u5b98\u65b9\u6dd8\u5b9d   : https://100ask.taobao.com\n\'\'\'\nimport os\nimport sys\nfrom media.media import MediaManager\nfrom media.pyaudio import PyAudio\nimport media.wave as wave\n\ndef exit_check():\n    """\u68c0\u6d4b\u662f\u5426\u6536\u5230\u9000\u51fa\u4fe1\u53f7"""\n    try:\n        os.exitpoint()\n    except KeyboardInterrupt:\n        print("User interrupted playback.")\n        return True\n    return False\n\nclass AudioPlayer:\n    def __init__(self, filename):\n        self.filename = filename\n        self.chunk = None\n        self.wf = None\n        self.p = None\n        self.stream = None\n\n    def _init_wave(self):\n        """\u6253\u5f00 WAV \u6587\u4ef6\u5e76\u8bfb\u53d6\u53c2\u6570"""\n        self.wf = wave.open(self.filename, \'rb\')\n        self.chunk = int(self.wf.get_framerate() / 25)\n\n    def _init_audio(self):\n        """\u521d\u59cb\u5316\u97f3\u9891\u7cfb\u7edf\u5e76\u521b\u5efa\u8f93\u51fa\u6d41"""\n        self.p = PyAudio()\n        self.p.initialize(self.chunk)\n        MediaManager.init()\n\n        self.stream = self.p.open(\n            format=self.p.get_format_from_width(self.wf.get_sampwidth()),\n            channels=self.wf.get_channels(),\n            rate=self.wf.get_framerate(),\n            output=True,\n            frames_per_buffer=self.chunk\n        )\n\n    def play(self):\n        """\u64ad\u653e WAV \u6587\u4ef6"""\n        try:\n            print(f"Start playing: {self.filename}")\n            self._init_wave()\n            self._init_audio()\n\n            data = self.wf.read_frames(self.chunk)\n            while data:\n                self.stream.write(data)\n                if exit_check():\n                    break\n                data = self.wf.read_frames(self.chunk)\n\n            print("Playback finished.")\n        except Exception as e:\n            print(f"Exception during playback: {e}")\n            sys.print_exception(e)\n        finally:\n            self._cleanup()\n\n    def _cleanup(self):\n        """\u91ca\u653e\u8d44\u6e90"""\n        if self.stream:\n            self.stream.stop_stream()\n            self.stream.close()\n        if self.p:\n            self.p.terminate()\n        if self.wf:\n            self.wf.close()\n        MediaManager.deinit()\n\ndef main():\n    os.exitpoint(os.EXITPOINT_ENABLE)\n    print("Audio Player Sample Start")\n    player = AudioPlayer("/data/test.wav")\n    player.play()\n    print("Audio Player Sample Done")\n\nif __name__ == "__main__":\n    main()\n'})}),"\n",(0,t.jsx)(n.h2,{id:"3\u5b9e\u9a8c\u7ed3\u679c",children:"3.\u5b9e\u9a8c\u7ed3\u679c"}),"\n",(0,t.jsx)(n.p,{children:"\u200b\t\u70b9\u51fb\u8fd0\u884c\u7a0b\u5e8f\u540e\uff0c\u53ef\u4ee5\u5728\u8033\u673a\u63a5\u53e3\u5904\u8f93\u51fa\u97f3\u9891\u3002"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20250423151422948",src:a(16050).Z+"",width:"860",height:"1030"})})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},16050:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/image-20250423151422948-1f4c98362ef98c082777180b500a0292.png"},11151:(e,n,a)=>{a.d(n,{Z:()=>l,a:()=>r});var t=a(67294);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);