"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[1832],{28453:(s,n,e)=>{e.d(n,{R:()=>c,x:()=>l});var a=e(96540);const i={},r=a.createContext(i);function c(s){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof s?s(n):{...n,...s}},[n,s])}function l(s){let n;return n=s.disableParentContext?"function"==typeof s.components?s.components(i):s.components||i:c(s.components),a.createElement(r.Provider,{value:n},s.children)}},66531:(s,n,e)=>{e.r(n),e.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var a=e(74848),i=e(28453);const r={sidebar_position:3},c="\u5706\u5f62\u68c0\u6d4b",l={id:"CanaanK230/part11/Circulardetection",title:"\u5706\u5f62\u68c0\u6d4b",description:"1.\u5b9e\u9a8c\u76ee\u7684",source:"@site/docs/CanaanK230/part11/03-Circulardetection.md",sourceDirName:"CanaanK230/part11",slug:"/CanaanK230/part11/Circulardetection",permalink:"/en/CanaanK230/part11/Circulardetection",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/eLinuxAI-TrainingDocs/tree/main/docs/CanaanK230/part11/03-Circulardetection.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"canaanK230Sidebar",previous:{title:"\u7ebf\u6bb5\u68c0\u6d4b",permalink:"/en/CanaanK230/part11/Linedetection"},next:{title:"\u77e9\u5f62\u68c0\u6d4b",permalink:"/en/CanaanK230/part11/Rectdetection"}},t={},m=[{value:"1.\u5b9e\u9a8c\u76ee\u7684",id:"1\u5b9e\u9a8c\u76ee\u7684",level:2},{value:"2.\u5b9e\u9a8c\u539f\u7406",id:"2\u5b9e\u9a8c\u539f\u7406",level:2},{value:"2.1 \u539f\u7406\u89e3\u6790",id:"21-\u539f\u7406\u89e3\u6790",level:3},{value:"3.\u4ee3\u7801\u89e3\u6790",id:"3\u4ee3\u7801\u89e3\u6790",level:2},{value:"4.\u793a\u4f8b\u4ee3\u7801",id:"4\u793a\u4f8b\u4ee3\u7801",level:2},{value:"5.\u5b9e\u9a8c\u7ed3\u679c",id:"5\u5b9e\u9a8c\u7ed3\u679c",level:2}];function h(s){const n={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",mspace:"mspace",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",...(0,i.R)(),...s.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"\u5706\u5f62\u68c0\u6d4b",children:"\u5706\u5f62\u68c0\u6d4b"}),"\n",(0,a.jsx)(n.h2,{id:"1\u5b9e\u9a8c\u76ee\u7684",children:"1.\u5b9e\u9a8c\u76ee\u7684"}),"\n",(0,a.jsx)(n.p,{children:"\u5b9e\u73b0K230\u5bf9\u56fe\u50cf\u4e2d\u7684\u5706\u5f62\u8fdb\u884c\u68c0\u6d4b\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"2\u5b9e\u9a8c\u539f\u7406",children:"2.\u5b9e\u9a8c\u539f\u7406"}),"\n",(0,a.jsx)(n.h3,{id:"21-\u539f\u7406\u89e3\u6790",children:"2.1 \u539f\u7406\u89e3\u6790"}),"\n",(0,a.jsxs)(n.p,{children:["\u5706\u5f62\u68c0\u6d4b\u901a\u5e38\u662f\u901a\u8fc7 ",(0,a.jsx)(n.strong,{children:"\u970d\u592b\u5706\u53d8\u6362\uff08Hough Circle Transform\uff09"})," \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u662f\u7ecf\u5178\u970d\u592b\u53d8\u6362\uff08\u7528\u4e8e\u76f4\u7ebf\u68c0\u6d4b\uff09\u7684\u6269\u5c55\uff0c\u9002\u7528\u4e8e\u68c0\u6d4b\u56fe\u50cf\u4e2d\u7684\u5706\u5f62\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u970d\u592b\u5706\u53d8\u6362\u7684\u76ee\u6807\u662f\uff1a\n\u4ece\u56fe\u50cf\u4e2d",(0,a.jsx)(n.strong,{children:"\u627e\u51fa\u8fb9\u7f18\u50cf\u7d20\u70b9"}),"\uff0c\u7136\u540e",(0,a.jsx)(n.strong,{children:"\u53cd\u63a8\u51fa\u53ef\u80fd\u7684\u5706\u5fc3\u548c\u534a\u5f84"}),"\uff0c\u5c06\u5b83\u4eec\u6295\u7968\u7d2f\u52a0\uff0c\u627e\u5230\u5f97\u7968\u6700\u591a\u7684\u90a3\u7ec4 (a,b,r)\u5373\u4e3a\u68c0\u6d4b\u5230\u7684\u5706\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4\u5982\u4e0b\uff1a"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u8fb9\u7f18\u68c0\u6d4b"}),"\uff08\u5982\u4f7f\u7528 Canny \u7b97\u5b50\uff09\n\u63d0\u53d6\u51fa\u56fe\u50cf\u4e2d\u6f5c\u5728\u7684\u8fb9\u7f18\u50cf\u7d20\uff08\u8fd9\u4e9b\u70b9\u53ef\u80fd\u5728\u5706\u7684\u8fb9\u7f18\u4e0a\uff09\u3002"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6295\u7968\u7d2f\u52a0\uff08Hough \u7d2f\u52a0\u5668\uff09"}),"\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8fb9\u7f18\u70b9 (x,y)\uff0c\u679a\u4e3e\u53ef\u80fd\u7684\u534a\u5f84 r\uff0c\u5e76\u6839\u636e\u5706\u65b9\u7a0b\u8ba1\u7b97\u53ef\u80fd\u7684\u5706\u5fc3 (a,b)\uff1a"]}),"\n",(0,a.jsx)(n.span,{className:"katex-display",children:(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mo,{children:"="}),(0,a.jsx)(n.mi,{children:"x"}),(0,a.jsx)(n.mo,{children:"\u2212"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mo,{children:"\u22c5"}),(0,a.jsx)(n.mi,{children:"cos"}),(0,a.jsx)(n.mo,{children:"\u2061"}),(0,a.jsx)(n.mo,{stretchy:"false",children:"("}),(0,a.jsx)(n.mi,{children:"\u03b8"}),(0,a.jsx)(n.mo,{stretchy:"false",children:")"}),(0,a.jsx)(n.mo,{separator:"true",children:","}),(0,a.jsx)(n.mspace,{width:"1em"}),(0,a.jsx)(n.mi,{children:"b"}),(0,a.jsx)(n.mo,{children:"="}),(0,a.jsx)(n.mi,{children:"y"}),(0,a.jsx)(n.mo,{children:"\u2212"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mo,{children:"\u22c5"}),(0,a.jsx)(n.mi,{children:"sin"}),(0,a.jsx)(n.mo,{children:"\u2061"}),(0,a.jsx)(n.mo,{stretchy:"false",children:"("}),(0,a.jsx)(n.mi,{children:"\u03b8"}),(0,a.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"a = x - r \\cdot \\cos(\\theta), \\quad b = y - r \\cdot \\sin(\\theta)"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(n.span,{className:"mrel",children:"="}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6667em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u2212"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.4445em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u22c5"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mop",children:"cos"}),(0,a.jsx)(n.span,{className:"mopen",children:"("}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"}),(0,a.jsx)(n.span,{className:"mclose",children:")"}),(0,a.jsx)(n.span,{className:"mpunct",children:","}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"1em"}}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"b"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(n.span,{className:"mrel",children:"="}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u2212"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.4445em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u22c5"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mop",children:"sin"}),(0,a.jsx)(n.span,{className:"mopen",children:"("}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"}),(0,a.jsx)(n.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,a.jsx)(n.p,{children:"\u6240\u6709\u53ef\u80fd\u7684 (a,b,r) \u5728\u4e09\u7ef4\u7a7a\u95f4\u4e2d\u6295\u7968\u3002"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u5bfb\u627e\u5c40\u90e8\u6700\u5927\u503c"}),"\n\u7d2f\u52a0\u5668\u4e2d\u6295\u7968\u503c\u6700\u9ad8\u7684\u70b9\uff0c\u5c31\u662f\u56fe\u50cf\u4e2d\u5b58\u5728\u5706\u5f62\u7684\u6982\u7387\u6700\u5927\u7684\u5730\u65b9\u3002"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"3\u4ee3\u7801\u89e3\u6790",children:"3.\u4ee3\u7801\u89e3\u6790"}),"\n",(0,a.jsx)(n.h2,{id:"4\u793a\u4f8b\u4ee3\u7801",children:"4.\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'import cv2\nimport numpy as np\n\n# \u6444\u50cf\u5934\u914d\u7f6e\u53c2\u6570\nSENSOR_W, SENSOR_H = 1280, 960  # \u6444\u50cf\u5934\u91c7\u96c6\u5206\u8fa8\u7387\uff08\u539f\u59cb\uff09\nFRAME_W, FRAME_H = 320, 240     # \u5b9e\u9645\u8f93\u51fa\u5e27\u5927\u5c0f\n\n# \u6253\u5f00\u6444\u50cf\u59341\u5e76\u8bbe\u7f6e\u5206\u8fa8\u7387\ncap = cv2.VideoCapture(1)\ncap.set(cv2.CAP_PROP_FRAME_WIDTH, SENSOR_W)\ncap.set(cv2.CAP_PROP_FRAME_HEIGHT, SENSOR_H)\n\n# \u68c0\u67e5\u6444\u50cf\u5934\u662f\u5426\u6210\u529f\u6253\u5f00\nif not cap.isOpened():\n    print(f"\u65e0\u6cd5\u6253\u5f00\u6444\u50cf\u59341(\u5206\u8fa8\u7387{SENSOR_W}x{SENSOR_H})\uff01\u8bf7\u68c0\u67e5\u8bbe\u5907\u8fde\u63a5\u3002")\n    exit()\n\nprint(f"\u6444\u50cf\u5934\u8bbe\u7f6e: \u91c7\u96c6 {SENSOR_W}x{SENSOR_H} \u2192 \u5904\u7406 {FRAME_W}x{FRAME_H}")\n\n\n# \u7f29\u653e\u6bd4\u4f8b\u8ba1\u7b97 (\u7528\u4e8e\u68c0\u6d4b\u53c2\u6570\u7684\u8c03\u6574)\nSCALE_FACTOR = max(SENSOR_W/FRAME_W, SENSOR_H/FRAME_H)\n\nwhile True:\n    # \u6355\u83b7\u9ad8\u5206\u8fa8\u7387\u5e27\n    ret, frame_high_res = cap.read()\n    if not ret:\n        print("\u65e0\u6cd5\u83b7\u53d6\u5e27\uff0c\u9000\u51fa\u4e2d...")\n        break\n    \n    # \u7f29\u653e\u81f3\u5904\u7406\u5c3a\u5bf8\n    frame = cv2.resize(frame_high_res, (FRAME_W, FRAME_H))\n    \n    # \u8f6c\u6362\u4e3a\u7070\u5ea6\u56fe\u50cf\n    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)\n    \n    # \u9ad8\u65af\u6a21\u7cca\u964d\u566a\n    blurred = cv2.GaussianBlur(gray, (9, 9), 2)\n    \n    # \u81ea\u9002\u5e94\u53c2\u6570\u8ba1\u7b97 (\u6839\u636e\u7f29\u653e\u6bd4\u4f8b\u8c03\u6574)\n    min_dist_scaled = max(20, int(50 / SCALE_FACTOR))\n    min_radius_scaled = max(5, int(10 / SCALE_FACTOR))\n    max_radius_scaled = min(100, int(100 / SCALE_FACTOR))\n    \n    # \u970d\u592b\u5706\u68c0\u6d4b\n    circles = cv2.HoughCircles(\n        blurred, \n        cv2.HOUGH_GRADIENT, \n        dp=1,   # \u5206\u8fa8\u7387\u56e0\u5b50\n        minDist=min_dist_scaled,  # \u5706\u4e4b\u95f4\u7684\u6700\u5c0f\u8ddd\u79bb(\u7f29\u653e\u8c03\u6574)\n        param1=50,   # Canny\u8fb9\u7f18\u68c0\u6d4b\u9608\u503c\n        param2=30,   # \u5706\u5fc3\u68c0\u6d4b\u9608\u503c(\u8d8a\u5c0f\u68c0\u6d4b\u8d8a\u591a)\n        minRadius=min_radius_scaled, # \u6700\u5c0f\u534a\u5f84(\u7f29\u653e\u8c03\u6574)\n        maxRadius=max_radius_scaled   # \u6700\u5927\u534a\u5f84(\u7f29\u653e\u8c03\u6574)\n    )\n    \n    # \u7ed8\u5236\u68c0\u6d4b\u5230\u7684\u5706\n    if circles is not None:\n        circles = np.uint16(np.around(circles))\n        for circle in circles[0, :]:\n            # \u5c06\u5750\u6807\u8f6c\u6362\u56de\u9ad8\u5206\u8fa8\u7387\u5750\u6807\u7cfb\n            x_high_res = int(circle[0] * SCALE_FACTOR)\n            y_high_res = int(circle[1] * SCALE_FACTOR)\n            radius_high_res = int(circle[2] * SCALE_FACTOR)\n            \n            # \u5728\u9ad8\u5206\u8fa8\u7387\u5e27\u4e0a\u7ed8\u5236\n            cv2.circle(frame_high_res, \n                      (x_high_res, y_high_res), \n                      radius_high_res, \n                      (0, 255, 0), 3)\n            # \u7ed8\u5236\u5706\u5fc3\n            cv2.circle(frame_high_res, \n                      (x_high_res, y_high_res), \n                      3, \n                      (0, 0, 255), 5)\n    \n    # \u5728\u9ad8\u5206\u8fa8\u7387\u5e27\u4e0a\u6dfb\u52a0\u5206\u8fa8\u7387\u4fe1\u606f\n    cv2.putText(frame_high_res, \n               f"Sensor: {SENSOR_W}x{SENSOR_H} | Display: {FRAME_W}x{FRAME_H}",\n               (10, 30), cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 0, 255), 2)\n    \n    # \u663e\u793a\u9ad8\u5206\u8fa8\u7387\u7ed3\u679c\n    cv2.imshow(\'Real-time Circle Detection\', frame_high_res)\n    \n    # \u6309\'q\'\u952e\u9000\u51fa\n    if cv2.waitKey(1) & 0xFF == ord(\'q\'):\n        break\n\n# \u91ca\u653e\u8d44\u6e90\ncap.release()\ncv2.destroyAllWindows()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"5\u5b9e\u9a8c\u7ed3\u679c",children:"5.\u5b9e\u9a8c\u7ed3\u679c"}),"\n",(0,a.jsx)(n.p,{children:"\u8fd0\u884c\u4ee3\u7801\u540e\u53ef\u4ee5\u5728\u663e\u793a\u5c4f\u4e0a\u5b9e\u65f6\u663e\u793a\u68c0\u6d4b\u5230\u7684\u5706\u5f62\u3002"})]})}function d(s={}){const{wrapper:n}={...(0,i.R)(),...s.components};return n?(0,a.jsx)(n,{...s,children:(0,a.jsx)(h,{...s})}):h(s)}}}]);