"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7065],{51438:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>d});var a=e(85893),s=e(11151);const t={sidebar_position:3},r="AprilTag\u6807\u7b7e\u8bc6\u522b",l={id:"CanaanK230/part13/findApriltags",title:"AprilTag\u6807\u7b7e\u8bc6\u522b",description:"1.\u5b9e\u9a8c\u76ee\u7684",source:"@site/docs/CanaanK230/part13/03-findApriltags.md",sourceDirName:"CanaanK230/part13",slug:"/CanaanK230/part13/findApriltags",permalink:"/en/CanaanK230/part13/findApriltags",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/eLinuxAI-TrainingDocs/tree/main/docs/CanaanK230/part13/03-findApriltags.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"canaanK230Sidebar",previous:{title:"\u4e8c\u7ef4\u7801\u8bc6\u522b",permalink:"/en/CanaanK230/part13/findQrcodes"},next:{title:"AprilTag\u59ff\u6001\u4f30\u8ba1",permalink:"/en/CanaanK230/part13/findApriltags3dPose"}},o={},d=[{value:"1.\u5b9e\u9a8c\u76ee\u7684",id:"1\u5b9e\u9a8c\u76ee\u7684",level:2},{value:"2.\u5b9e\u9a8c\u539f\u7406",id:"2\u5b9e\u9a8c\u539f\u7406",level:2},{value:"3.\u4ee3\u7801\u89e3\u6790",id:"3\u4ee3\u7801\u89e3\u6790",level:2},{value:"\u914d\u7f6e\u652f\u6301\u7684 AprilTag \u5bb6\u65cf",id:"\u914d\u7f6e\u652f\u6301\u7684-apriltag-\u5bb6\u65cf",level:3},{value:"\u6444\u50cf\u5934\u4e0e\u5c4f\u5e55\u521d\u59cb\u5316",id:"\u6444\u50cf\u5934\u4e0e\u5c4f\u5e55\u521d\u59cb\u5316",level:3},{value:"\u56fe\u50cf\u8bc6\u522b\u4e0e\u7ed8\u56fe",id:"\u56fe\u50cf\u8bc6\u522b\u4e0e\u7ed8\u56fe",level:3},{value:"\u663e\u793a\u56fe\u50cf",id:"\u663e\u793a\u56fe\u50cf",level:3},{value:"4.\u793a\u4f8b\u4ee3\u7801",id:"4\u793a\u4f8b\u4ee3\u7801",level:2},{value:"5.\u5b9e\u9a8c\u7ed3\u679c",id:"5\u5b9e\u9a8c\u7ed3\u679c",level:2}];function g(n){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.h1,{id:"apriltag\u6807\u7b7e\u8bc6\u522b",children:"AprilTag\u6807\u7b7e\u8bc6\u522b"}),"\n",(0,a.jsx)(i.h2,{id:"1\u5b9e\u9a8c\u76ee\u7684",children:"1.\u5b9e\u9a8c\u76ee\u7684"}),"\n",(0,a.jsx)(i.p,{children:"\u5b66\u4e60\u6444\u50cf\u5934\u521d\u59cb\u5316\u3001AprilTag \u68c0\u6d4b\u3001\u5c4f\u5e55\u7ed8\u5236\u7b49\u6838\u5fc3\u6d41\u7a0b"}),"\n",(0,a.jsx)(i.h2,{id:"2\u5b9e\u9a8c\u539f\u7406",children:"2.\u5b9e\u9a8c\u539f\u7406"}),"\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"AprilTag"})," \u662f\u4e00\u79cd\u7c7b\u4f3c\u4e8c\u7ef4\u7801\u7684\u56fe\u50cf\u8bc6\u522b\u6807\u7b7e\uff0c\u5e38\u7528\u4e8e\u673a\u5668\u4eba\u5b9a\u4f4d\u4e0e\u5bfc\u822a\u3002\u76f8\u6bd4\u4e8c\u7ef4\u7801\uff0cAprilTags \u66f4\u9002\u5408\u7528\u4e8e ",(0,a.jsx)(i.strong,{children:"\u7cbe\u786e\u5b9a\u4f4d\u548c\u59ff\u6001\u4f30\u8ba1"}),"\uff0c\u5e76\u4e14\u652f\u6301\u591a\u4e2a",(0,a.jsx)(i.strong,{children:"\u6807\u7b7e\u5bb6\u65cf"}),"\uff08tag families\uff09\uff0c\u4e0d\u540c\u5bb6\u65cf\u5177\u6709\u4e0d\u540c\u7684\u7f16\u7801\u7ed3\u6784\u4e0e\u9c81\u68d2\u6027\u3002"]}),"\n",(0,a.jsx)(i.h2,{id:"3\u4ee3\u7801\u89e3\u6790",children:"3.\u4ee3\u7801\u89e3\u6790"}),"\n",(0,a.jsx)(i.h3,{id:"\u914d\u7f6e\u652f\u6301\u7684-apriltag-\u5bb6\u65cf",children:"\u914d\u7f6e\u652f\u6301\u7684 AprilTag \u5bb6\u65cf"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{children:"tag_families = 0\ntag_families |= image.TAG16H5\ntag_families |= image.TAG25H7\ntag_families |= image.TAG25H9\ntag_families |= image.TAG36H10\ntag_families |= image.TAG36H11  # \u9ed8\u8ba4\u63a8\u8350\u4f7f\u7528\ntag_families |= image.ARTOOLKIT\n"})}),"\n",(0,a.jsxs)(i.p,{children:["\u4f60\u53ef\u4ee5\u6839\u636e\u9700\u8981",(0,a.jsx)(i.strong,{children:"\u6ce8\u91ca/\u53d6\u6d88\u6ce8\u91ca"}),"\u8fd9\u4e9b\u5bb6\u65cf\uff0c\u9ed8\u8ba4\u542f\u7528\u5168\u90e8\u3002\u63a8\u8350\u4f7f\u7528 ",(0,a.jsx)(i.code,{children:"TAG36H11"}),"\uff0c\u8bc6\u522b\u51c6\u786e\u7387\u9ad8\uff0c\u8bef\u68c0\u7387\u4f4e\u3002"]}),"\n",(0,a.jsx)(i.h3,{id:"\u6444\u50cf\u5934\u4e0e\u5c4f\u5e55\u521d\u59cb\u5316",children:"\u6444\u50cf\u5934\u4e0e\u5c4f\u5e55\u521d\u59cb\u5316"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{children:"sensor = Sensor(width = DETECT_WIDTH, height = DETECT_HEIGHT)\nsensor.reset()\nsensor.set_framesize(width = DETECT_WIDTH, height = DETECT_HEIGHT)\nsensor.set_pixformat(Sensor.RGB565)\nDisplay.init(Display.ST7701, to_ide = True)\nMediaManager.init()\nsensor.run()\n"})}),"\n",(0,a.jsxs)(i.p,{children:["\u4f7f\u7528 ",(0,a.jsx)(i.code,{children:"ST7701"})," LCD \u5c4f\u4f5c\u4e3a\u8f93\u51fa\uff08\u4e5f\u53ef\u4ee5\u6539\u4e3a HDMI \u6216\u865a\u62df IDE \u8f93\u51fa\uff09\u3002"]}),"\n",(0,a.jsx)(i.h3,{id:"\u56fe\u50cf\u8bc6\u522b\u4e0e\u7ed8\u56fe",children:"\u56fe\u50cf\u8bc6\u522b\u4e0e\u7ed8\u56fe"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{children:'img = sensor.snapshot()\n\nfor tag in img.find_apriltags(families=tag_families):\n    img.draw_rectangle([v for v in tag.rect()], color=(255, 0, 0))    # \u753b\u77e9\u5f62\u6846\n    img.draw_cross(tag.cx(), tag.cy(), color=(0, 255, 0))            # \u753b\u4e2d\u5fc3\u5341\u5b57\n    print("Tag Family %s, ID %d, rotation %f" % (...))               # \u6253\u5370\u8bc6\u522b\u4fe1\u606f\n'})}),"\n",(0,a.jsx)(i.p,{children:"\u6bcf\u4e00\u5e27\u56fe\u50cf\u4f1a\u8fdb\u884c\u6807\u7b7e\u8bc6\u522b\uff0c\u5e76\u5728\u5c4f\u5e55\u4e0a\u7ed8\u5236\u7ea2\u6846\u3001\u4e2d\u5fc3\u70b9\uff0c\u4ee5\u53ca\u6253\u5370\u6807\u7b7e\u5bb6\u65cf\u4e0e ID\u3002"}),"\n",(0,a.jsx)(i.h3,{id:"\u663e\u793a\u56fe\u50cf",children:"\u663e\u793a\u56fe\u50cf"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{children:"Display.show_image(img, x=round((800-sensor.width())/2), y=round((480-sensor.height())/2))\n"})}),"\n",(0,a.jsx)(i.p,{children:"\u5c06\u56fe\u50cf\u663e\u793a\u5728\u5c4f\u5e55\u4e2d\u592e\uff08\u5c4f\u5e55\u4e3a 800\xd7480 \u65f6\uff09\u3002"}),"\n",(0,a.jsx)(i.h2,{id:"4\u793a\u4f8b\u4ee3\u7801",children:"4.\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{children:'\'\'\'\n\u672c\u7a0b\u5e8f\u9075\u5faaGPL V3\u534f\u8bae, \u8bf7\u9075\u5faa\u534f\u8bae\n\u5b9e\u9a8c\u5e73\u53f0: DshanPI CanMV\n\u5f00\u53d1\u677f\u6587\u6863\u7ad9\u70b9\t: https://eai.100ask.net/\n\u767e\u95ee\u7f51\u5b66\u4e60\u5e73\u53f0   : https://www.100ask.net\n\u767e\u95ee\u7f51\u5b98\u65b9B\u7ad9    : https://space.bilibili.com/275908810\n\u767e\u95ee\u7f51\u5b98\u65b9\u6dd8\u5b9d   : https://100ask.taobao.com\n\'\'\'\n\nimport time, math, os, gc, sys\n\nfrom media.sensor import *\nfrom media.display import *\nfrom media.media import *\n\n# \u8bbe\u7f6e\u56fe\u50cf\u68c0\u6d4b\u533a\u57df\u5206\u8fa8\u7387\nDETECT_WIDTH = 320\nDETECT_HEIGHT = 240\n\n# \u6ce8\u610f\uff1a\u4e0e find_qrcodes \u4e0d\u540c\uff0cfind_apriltags \u65b9\u6cd5\u4e0d\u9700\u8981\u5bf9\u56fe\u50cf\u8fdb\u884c\u955c\u5934\u7578\u53d8\u77eb\u6b63\u3002\n\n# apriltag \u652f\u6301\u540c\u65f6\u5904\u7406\u6700\u591a 6 \u4e2a\u6807\u7b7e\u65cf\uff08tag family\uff09\n# \u8fd4\u56de\u7684\u6807\u7b7e\u5bf9\u8c61\u4e2d\u4f1a\u5305\u542b\u8be5\u6807\u7b7e\u6240\u5c5e\u7684\u65cf\u4fe1\u606f\u53ca\u5176\u5728\u8be5\u65cf\u4e2d\u7684 ID\u3002\n\ntag_families = 0\ntag_families |= image.TAG16H5  # 4x4 \u65b9\u5f62\uff0c\u68c0\u6d4b\u8ddd\u79bb\u8fdc\uff0c\u4f46\u8bef\u68c0\u7387\u8f83\u9ad8\ntag_families |= image.TAG25H7  # \u53ef\u6839\u636e\u9700\u8981\u542f\u7528\ntag_families |= image.TAG25H9  # \u53ef\u6839\u636e\u9700\u8981\u542f\u7528\ntag_families |= image.TAG36H10 # \u53ef\u6839\u636e\u9700\u8981\u542f\u7528\ntag_families |= image.TAG36H11 # \u9ed8\u8ba4\u542f\u7528\uff0c\u8bef\u68c0\u7387\u4f4e\ntag_families |= image.ARTOOLKIT # \u53ef\u6839\u636e\u9700\u8981\u542f\u7528\n\n# \u6807\u7b7e\u65cf\u7684\u533a\u522b\u8bf4\u660e\uff1a\n# TAG16H5 \u662f\u4e00\u4e2a 4x4 \u7684\u65b9\u5f62\u6807\u7b7e\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u8f83\u8fdc\u8ddd\u79bb\u88ab\u8bc6\u522b\uff1b\n# \u800c TAG36H11 \u662f 6x6 \u7684\u6807\u7b7e\uff0c\u867d\u7136\u8bc6\u522b\u8ddd\u79bb\u8fd1\uff0c\u4f46\u8bef\u68c0\u7387\u8f83\u4f4e\u3002\n# \u9664\u975e\u4f60\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u5426\u5219\u5efa\u8bae\u4f7f\u7528 TAG36H11\u3002\n\n# \u6839\u636e\u6807\u7b7e\u8fd4\u56de\u5176\u65cf\u540d\u79f0\u7684\u8f85\u52a9\u51fd\u6570\ndef family_name(tag):\n    if(tag.family() == image.TAG16H5):\n        return "TAG16H5"\n    if(tag.family() == image.TAG25H7):\n        return "TAG25H7"\n    if(tag.family() == image.TAG25H9):\n        return "TAG25H9"\n    if(tag.family() == image.TAG36H10):\n        return "TAG36H10"\n    if(tag.family() == image.TAG36H11):\n        return "TAG36H11"\n    if(tag.family() == image.ARTOOLKIT):\n        return "ARTOOLKIT"\n\nsensor = None\n\ntry:\n    # \u521b\u5efa\u5e76\u521d\u59cb\u5316\u6444\u50cf\u5934\u5bf9\u8c61\n    sensor = Sensor(width = DETECT_WIDTH, height = DETECT_HEIGHT)\n    sensor.reset()  # \u91cd\u7f6e\u6444\u50cf\u5934\n\n    # \u5982\u9700\u56fe\u50cf\u7ffb\u8f6c\uff0c\u53ef\u53d6\u6d88\u4ee5\u4e0b\u6ce8\u91ca\uff1a\n    # sensor.set_hmirror(False)  # \u8bbe\u7f6e\u6c34\u5e73\u955c\u50cf\n    # sensor.set_vflip(False)    # \u8bbe\u7f6e\u5782\u76f4\u7ffb\u8f6c\n\n    # \u8bbe\u7f6e\u901a\u90530\u7684\u8f93\u51fa\u5206\u8fa8\u7387\u548c\u50cf\u7d20\u683c\u5f0f\n    sensor.set_framesize(width = DETECT_WIDTH, height = DETECT_HEIGHT)\n    sensor.set_pixformat(Sensor.RGB565)  # \u8bbe\u7f6e RGB565 \u683c\u5f0f\u8f93\u51fa\n\n    # \u521d\u59cb\u5316\u663e\u793a\u8bbe\u5907\n    # \u5982\u4f7f\u7528 HDMI \u8f93\u51fa\uff0c\u8bf7\u6839\u636e\u5b9e\u9645\u9700\u6c42\u53d6\u6d88\u5bf9\u5e94\u6ce8\u91ca\uff1a\n    # Display.init(Display.LT9611, width = 640, height = 480, to_ide = True)\n    # Display.init(Display.LT9611, width = 1920, height = 1080, to_ide = True)\n\n    # \u5982\u4f7f\u7528 LCD \u8f93\u51fa\uff0c\u9ed8\u8ba4\u4f7f\u7528 ST7701 \u9762\u677f\uff1a\n    Display.init(Display.ST7701, to_ide = True)\n\n    # \u5982\u4ec5\u5728 IDE \u663e\u793a\u5668\u4e2d\u663e\u793a\uff0c\u53ef\u4f7f\u7528\u865a\u62df\u663e\u793a\uff1a\n    # Display.init(Display.VIRT, width = DETECT_WIDTH, height = DETECT_HEIGHT, fps = 100)\n\n    # \u521d\u59cb\u5316\u5a92\u4f53\u7ba1\u7406\u5668\uff08\u56fe\u50cf\u663e\u793a\u7f13\u51b2\u5668\uff09\n    MediaManager.init()\n\n    # \u542f\u52a8\u6444\u50cf\u5934\u56fe\u50cf\u91c7\u96c6\n    sensor.run()\n\n    # \u521b\u5efa FPS \u8ba1\u65f6\u5668\n    fps = time.clock()\n\n    while True:\n        fps.tick()  # \u5f00\u59cb\u65b0\u4e00\u5e27\u8ba1\u65f6\n\n        os.exitpoint()  # \u68c0\u67e5\u662f\u5426\u9700\u8981\u9000\u51fa\u7a0b\u5e8f\n\n        img = sensor.snapshot()  # \u62cd\u6444\u4e00\u5e27\u56fe\u50cf\n\n        # \u5728\u56fe\u50cf\u4e2d\u67e5\u627e\u6240\u6709\u6307\u5b9a\u65cf\u7684 AprilTags\n        for tag in img.find_apriltags(families=tag_families):\n            img.draw_rectangle([v for v in tag.rect()], color=(255, 0, 0))  # \u7ed8\u5236\u6807\u7b7e\u8fb9\u6846\n            img.draw_cross(tag.cx(), tag.cy(), color=(0, 255, 0))           # \u5728\u4e2d\u5fc3\u753b\u5341\u5b57\n\n            # \u6253\u5370\u6807\u7b7e\u4fe1\u606f\uff1a\u6807\u7b7e\u65cf\u3001ID\u3001\u65cb\u8f6c\u89d2\u5ea6\n            print_args = (family_name(tag), tag.id(), (180 * tag.rotation()) / math.pi)\n            print("Tag Family %s, Tag ID %d, rotation %f (degrees)" % print_args)\n\n        # \u5c06\u56fe\u50cf\u663e\u793a\u5728\u5c4f\u5e55\u4e2d\u592e\n        Display.show_image(\n            img,\n            x=round((800 - sensor.width()) / 2),\n            y=round((480 - sensor.height()) / 2)\n        )\n\n        # \u5783\u573e\u56de\u6536\uff0c\u91ca\u653e\u5185\u5b58\n        gc.collect()\n\n        # \u6253\u5370\u5f53\u524d\u5e27\u7387\n        print(fps.fps())\n\nexcept KeyboardInterrupt as e:\n    print("\u7528\u6237\u4e3b\u52a8\u7ec8\u6b62\u7a0b\u5e8f")\nexcept BaseException as e:\n    print(f"\u53d1\u751f\u5f02\u5e38: \'{e}\'")\nfinally:\n    # \u505c\u6b62\u6444\u50cf\u5934\n    if isinstance(sensor, Sensor):\n        sensor.stop()\n    # \u5173\u95ed\u663e\u793a\u8bbe\u5907\n    Display.deinit()\n\n    # \u8bbe\u7f6e\u9000\u51fa\u70b9\u5e76\u5ef6\u8fdf\u4e00\u4f1a\u4ee5\u786e\u4fdd\u8d44\u6e90\u91ca\u653e\n    os.exitpoint(os.EXITPOINT_ENABLE_SLEEP)\n    time.sleep_ms(100)\n\n    # \u91ca\u653e\u5a92\u4f53\u8d44\u6e90\n    MediaManager.deinit()\n'})}),"\n",(0,a.jsx)(i.h2,{id:"5\u5b9e\u9a8c\u7ed3\u679c",children:"5.\u5b9e\u9a8c\u7ed3\u679c"}),"\n",(0,a.jsx)(i.p,{children:"\u200b\t\u70b9\u51fb\u8fd0\u884c\u4ee3\u7801\u540e\u53ef\u4ee5\uff0c\u8bc6\u522b\u5230AprilTag\u6807\u7b7e\u3002"})]})}function p(n={}){const{wrapper:i}={...(0,s.a)(),...n.components};return i?(0,a.jsx)(i,{...n,children:(0,a.jsx)(g,{...n})}):g(n)}},11151:(n,i,e)=>{e.d(i,{Z:()=>l,a:()=>r});var a=e(67294);const s={},t=a.createContext(s);function r(n){const i=a.useContext(t);return a.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function l(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(t.Provider,{value:i},n.children)}}}]);